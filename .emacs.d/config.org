* Base config
** Setting name and email
   #+BEGIN_SRC emacs-lisp
   (setq user-full-name "Lucas Peixoto")
   (setq user-mail-address "lucaspeixotoac@gmail.com")
   #+END_SRC
** Minimal UI
   #+BEGIN_SRC emacs-lisp
     (scroll-bar-mode -1)
     (tool-bar-mode   -1)
     (tooltip-mode    -1)
     (menu-bar-mode   -1)
     (set-fringe-mode 10)        ; Give some breathing room
   #+END_SRC
** Fix undo tree bug
   #+BEGIN_SRC emacs-lisp
   (setq undo-tree-enable-undo-in-region nil)
   #+END_SRC
** Save undo tree for a file
   #+BEGIN_SRC emacs-lisp
     (setq undo-tree-auto-save-history t)
     (setq undo-tree-history-directory-alist '(("." . "~/.emacs.d/undo-tree")))
   #+END_SRC
** Yes and no alias
   #+BEGIN_SRC emacs-lisp
   (defalias 'yes-or-no-p 'y-or-n-p)
   #+END_SRC
** Open/load config file
   #+BEGIN_SRC emacs-lisp
     (setq EMACS_DIR "~/.emacs.d/")
     (setq CONFIG_FILE "config.org")
     (setq INIT_FILE "init.el")

     (defun find-config ()
       "Edit config.org"
       (interactive)
       (find-file (concat EMACS_DIR CONFIG_FILE)))
     (defun reload-config()
       "Reload config.org"
       (interactive)
       (load-file (concat EMACS_DIR INIT_FILE)))

     ;; (global-set-key (kbd "C-c cfg") 'find-config)
     ;; (global-set-key (kbd "C-c rcfg") 'reload-config)
   #+END_SRC
** Setting font
   #+BEGIN_SRC emacs-lisp
     (set-frame-font "Source Code Pro-13" nil t)
     (setq popup-use-optimized-column-computation nil)
   #+END_SRC
** Lines and columns
   #+BEGIN_SRC emacs-lisp
   (global-linum-mode 1)
   (line-number-mode 1)
   (column-number-mode 1)
   (setq-default fill-column 80)
   #+END_SRC
** Kill current buffer function
   #+BEGIN_SRC emacs-lisp
     (defun kill-current-buffer ()
       (interactive)
       (kill-buffer (current-buffer)))

     ;; (global-set-key (kbd "C-x k" ) 'kill-current-buffer)
   #+END_SRC
** Save the last location in open file
   #+BEGIN_SRC emacs-lisp
     (save-place-mode t)
   #+END_SRC
** Auto update git branch
   #+BEGIN_SRC emacs-lisp
  (setq auto-revert-check-vc-info t) 
   #+END_SRC
** Parentheses
   #+BEGIN_SRC emacs-lisp
   (show-paren-mode 1)
   #+END_SRC
** Bash terminal
    #+BEGIN_SRC emacs-lisp
      (defvar my-term-shell "/bin/bash")
      (defadvice ansi-term (before force-bash)
	(interactive (list my-term-shell)))
      (ad-activate 'ansi-term)

      ;; (global-set-key (kbd "C-c t") 'shell)
   #+END_SRC
** Smoth scroll
   #+BEGIN_SRC emacs-lisp
     (setq scroll-conservatively 100)
   #+END_SRC
** Highlight cursor line
   #+BEGIN_SRC emacs-lisp
     (global-hl-line-mode t)
   #+END_SRC
** Detect subword
   #+BEGIN_SRC emacs-lisp
     (global-subword-mode 1)
   #+END_SRC
** Indentation
   #+BEGIN_SRC emacs-lisp
     (setq-default indent-tabs-mode nil)
     (setq c-basic-offset 4)
   #+END_SRC
** Backup files
   #+BEGIN_SRC emacs-lisp
     (setq make-backup-files nil) ; stop creating backup~ files
     (setq auto-save-default nil) ; stop creating #autosave# files
     (setq create-lockfiles nil)
   #+END_SRC
** Setting PATH env
   #+BEGIN_SRC emacs-lisp
     (let ((path (shell-command-to-string ". ~/.zshrc; echo -n $PATH")))
       (setenv "PATH" path)
       (setq exec-path 
             (append
              (split-string-and-unquote path ":")
              exec-path)))

     (setenv "PATH"
       (concat
        (getenv "PATH")
       )
     )
   #+END_SRC
** Bookmarks
#+BEGIN_SRC emacs-lisp
  (setq bookmark-default-file "~/.emacs.d/my-bookmarks")
  (setq bookmark-save-flag 1)
#+END_SRC
** Highlight FIXME, TODO and BUG in prog mode
#+BEGIN_SRC emacs-lisp
  (add-hook 'prog-mode-hook
                 (lambda ()
                  (font-lock-add-keywords nil
                   '(("\\<\\(FIXME\\|TODO\\|BUG\\):" 1 font-lock-warning-face t)))))
#+END_SRC
** Disable line numbers for some nodes
  #+BEGIN_SRC emacs-lisp
    ;; Disable line numbers for some modes
    (dolist (mode '(org-mode-hook
                    term-mode-hook
                    shell-mode-hook
                    eshell-mode-hook))
      (add-hook mode (lambda () (display-line-numbers-mode 0))))
  #+END_SRC
* Packages config
** Org
   #+BEGIN_SRC emacs-lisp
   (use-package org)
   #+END_SRC
** Evil
   #+BEGIN_SRC emacs-lisp
     (use-package evil-leader
       :init
       (setq evil-want-C-u-scroll t)
       (setq evil-want-keybinding nil)
       (global-evil-leader-mode))
     (use-package evil
       :init
       (setq evil-want-integration nil) ;; required by evil-collection
       (setq evil-search-module 'isearch)
       (setq evil-ex-complete-emacs-commands nil)
       (setq evil-vsplit-window-right t) ;; like vim's 'splitright'
       (setq evil-split-window-below t) ;; like vim's 'splitbelow'
       (setq evil-shift-round nil)
       (setq evil-want-C-u-scroll t)
       :config
       (evil-mode)
       )

     ;; vim-like keybindings everywhere in emacs
     (use-package evil-collection
       :after evil
       :config
       (evil-collection-init))

     (use-package evil-commentary)
   #+END_SRC
** Selectrum
   #+BEGIN_SRC emacs-lisp
   (use-package selectrum
   :config
   (selectrum-mode +1))
   #+END_SRC
** Consult 
   #+BEGIN_SRC emacs-lisp
     (use-package consult
       :hook (completion-list-mode . consult-preview-at-point-mode)
       :init
       ;; Optionally configure the register formatting. This improves the register
       ;; preview for `consult-register', `consult-register-load',
       ;; `consult-register-store' and the Emacs built-ins.
       (setq register-preview-delay 0
             register-preview-function #'consult-register-format)

       ;; Optionally tweak the register preview window.
       ;; This adds thin lines, sorting and hides the mode line of the window.
       (advice-add #'register-preview :override #'consult-register-window)

       ;; Optionally replace `completing-read-multiple' with an enhanced version.
       (advice-add #'completing-read-multiple :override #'consult-completing-read-multiple)

       ;; Use Consult to select xref locations with preview
       (setq xref-show-xrefs-function #'consult-xref
             xref-show-definitions-function #'consult-xref)
       :config
       ;; Optionally configure preview. The default value
       ;; is 'any, such that any key triggers the preview.
       ;; (setq consult-preview-key 'any)
       ;; (setq consult-preview-key (kbd "M-."))
       ;; (setq consult-preview-key (list (kbd "<S-down>") (kbd "<S-up>")))
       ;; For some commands and buffer sources it is useful to configure the
       ;; :preview-key on a per-command basis using the `consult-customize' macro.
       (consult-customize
        consult-theme
        :preview-key '(:debounce 0.2 any)
        consult-ripgrep consult-git-grep consult-grep
        consult-bookmark consult-recent-file consult-xref
        consult--source-recent-file consult--source-project-recent-file consult--source-bookmark
        :preview-key (kbd "M-."))

       ;; Optionally configure the narrowing key.
       ;; Both < and C-+ work reasonably well.
       (setq consult-narrow-key "<") ;; (kbd "C-+")

       ;; Optionally make narrowing help available in the minibuffer.
       ;; You may want to use `embark-prefix-help-command' or which-key instead.
       ;; (define-key consult-narrow-map (vconcat consult-narrow-key "?") #'consult-narrow-help)

       ;; Optionally configure a function which returns the project root directory.
       ;; There are multiple reasonable alternatives to chose from.
       ;;;; 1. project.el (project-roots)
       ;;(setq consult-project-root-function
       ;;      (lambda ()
       ;;        (when-let (project (project-current))
       ;;          (car (project-roots project)))))
       ;;;; 2. projectile.el (projectile-project-root)
       (autoload 'projectile-project-root "projectile")
       (setq consult-project-root-function #'projectile-project-root)
       ;;;; 3. vc.el (vc-root-dir)
       ;; (setq consult-project-root-function #'vc-root-dir)
       ;;;; 4. locate-dominating-file
       ;; (setq consult-project-root-function (lambda () (locate-dominating-file "." ".git")))  
       )
   #+END_SRC
** Marginalia
   #+BEGIN_SRC emacs-lisp
     (use-package marginalia
       ;; The :init configuration is always executed (Not lazy!)
       :init

       ;; Must be in the :init section of use-package such that the mode gets
       ;; enabled right away. Note that this forces loading the package.
       (marginalia-mode))
   #+END_SRC
** Embark
   #+BEGIN_SRC emacs-lisp
     (use-package embark
       :bind
       ;; (("C-." . embark-act)         ;; pick some comfortable binding
       ;;  ("C-;" . embark-dwim)        ;; good alternative: M-.
       ;;  ("C-h B" . embark-bindings)) ;; alternative for `describe-bindings'

       :init
       ;; Optionally replace the key help with a completing-read interface
       (setq prefix-help-command #'embark-prefix-help-command)
       :config
       ;; Hide the mode line of the Embark live/completions buffers
       (add-to-list 'display-buffer-alist
                    '("\\`\\*Embark Collect \\(Live\\|Completions\\)\\*"
                      nil
                      (window-parameters (mode-line-format . none)))))

     ;; Consult users will also want the embark-consult package.
     (use-package embark-consult
       :after (embark consult)
       :demand t ; only necessary if you have the hook below
       ;; if you want to have consult previews as you move around an
       ;; auto-updating embark collect buffer
       :hook
       (embark-collect-mode . consult-preview-at-point-mode))
   #+END_SRC
** Prescient
  #+BEGIN_SRC emacs-lisp
    (use-package selectrum-prescient
      :config
      (setq selectrum-prescient-enable-filtering nil)
      (selectrum-prescient-mode +1)
      (prescient-persist-mode +1)
      )
  #+END_SRC
** Ordeless
   #+BEGIN_SRC emacs-lisp
     (use-package orderless
       :custom (completion-styles '(orderless))
       :config
       ;; Persist history over Emacs restarts
       (savehist-mode)

       ;; Optional performance optimization
       ;; by highlighting only the visible candidates.
       (setq orderless-skip-highlighting (lambda () selectrum-is-active))
       (setq selectrum-highlight-candidates-function #'orderless-highlight-matches) 
       )
   #+END_SRC
** All the icons
   #+BEGIN_SRC emacs-lisp
     (use-package all-the-icons)
   #+END_SRC
** Which keybindind
   #+BEGIN_SRC emacs-lisp
     (use-package which-key
       :init
       (setq which-key-separator " ")
       (setq which-key-prefix-prefix "+")
       :config
       (which-key-mode))
   #+END_SRC
** Themes and appearence
*** Modeline
    #+BEGIN_SRC emacs-lisp
      (use-package doom-modeline
            :hook (after-init . doom-modeline-mode)
            :config
            (setq doom-modeline-buffer-file-name-style 'relative-to-project)
            (setq doom-modeline-vcs-max-length 20)
            (setq doom-modeline-github-interval (* 1 60))
      )
    #+END_SRC
*** Doom themes
   #+BEGIN_SRC emacs-lisp
     (use-package doom-themes
       :config
       (setq doom-themes-enable-bold t    ; if nil, bold is universally disabled
             doom-themes-enable-italic t) ; if nil, italics is universally disabled
         (load-theme 'doom-one t)
         ;; (load-theme 'doom-one-light t)
       )
   #+END_SRC
*** Rainbow
    #+BEGIN_SRC emacs-lisp
      (use-package rainbow-delimiters
	:config
	(add-hook 'prog-mode-hook #'rainbow-delimiters-mode))
    #+END_SRC
*** Anzu
   #+BEGIN_SRC emacs-lisp
     (use-package anzu
       :config
       (global-anzu-mode +1))
   #+END_SRC
*** Beacon
   #+BEGIN_SRC emacs-lisp
     (use-package beacon
       :init
       (beacon-mode 1)
       :config
       (setq beacon-blink-duration 0.1)
       (setq beacon-size 20)
       (setq beacon-blink-delay 0.1)
     )
   #+END_SRC
*** Highlight numbers
    #+BEGIN_SRC emacs-lisp
      (use-package highlight-numbers
	:config
	(add-hook 'prog-mode-hook 'highlight-numbers-mode))
    #+END_SRC
** Avy
   #+BEGIN_SRC emacs-lisp
     (use-package avy
       :init
       (avy-setup-default)
       (setq avy-timeout-seconds 0.5)
       :bind
       )
   #+END_SRC
** Smartparens
   #+BEGIN_SRC emacs-lisp
     (defun my-fancy-newline ()
       "Add two newlines and put the cursor at the right indentation
     between them if a newline is attempted when the cursor is between
     two curly braces, otherwise do a regular newline and indent"
       (interactive)
       (if (and (equal (char-before) 123) ; {
                (equal (char-after) 125)) ; }
           (progn (newline-and-indent)
                  (split-line)
                  (indent-for-tab-command))
         (newline-and-indent)))

     ;; I set mine to C-j, you do you, don't let me tell you how to live your life.
     ;;(global-set-key (kbd "RET") 'my-fancy-newline)

     ;; smart parens
     (use-package smartparens
       :config
       (add-hook 'prog-mode-hook #'smartparens-mode)
       )
   #+END_SRC
** Ace window
   #+BEGIN_SRC emacs-lisp
          (use-package ace-window
            :config
            (setq aw-keys '(?a ?s ?d ?f ?g ?h ?j ?k ?l))
            (setq aw-background nil)
            (defvar aw-dispatch-alist
              '((?x aw-delete-window "Delete Window")
                (?m aw-swap-window "Swap Windows")
                (?M aw-move-window "Move Window")
                (?c aw-copy-window "Copy Window")
                (?j aw-switch-buffer-in-window "Select Buffer")
                (?n aw-flip-window)
                (?u aw-switch-buffer-other-window "Switch Buffer Other Window")
                (?c aw-split-window-fair "Split Fair Window")
                (?v aw-split-window-vert "Split Vert Window")
                (?b aw-split-window-horz "Split Horz Window")
                (?o delete-other-windows "Delete Other Windows")
                (?? aw-show-dispatch-help))
              "List of actions for `aw-dispatch-default'.")
           :bind
           ([remap other-window] . ace-window)
     )
   #+END_SRC
** Magit
   #+BEGIN_SRC emacs-lisp
     (use-package magit)
   #+END_SRC
** Neotree
   #+BEGIN_SRC emacs-lisp
     (defun neotree-project-dir ()
       "Open NeoTree using the git root."
       (interactive)
       (let ((project-dir (projectile-project-root))
	     (file-name (buffer-file-name)))
	 (neotree-toggle)
	 (if project-dir
	     (if (neo-global--window-exists-p)
		 (progn
		     (neotree-dir project-dir)
		     (neotree-find file-name)))
	   (message "Could not find git project root."))))

     (use-package neotree
       :config
       (setq neo-window-fixed-size nil)
       (setq neo-theme (if (display-graphic-p) 'icons 'arrow))
       (add-hook 'neotree-mode-hook
		 (lambda ()
		   (visual-line-mode -1)
		   (setq truncate-lines t)))
       ;;(global-set-key (kbd "C-c n") 'neotree-project-dir)
       )
   #+END_SRC
** Projectile
   #+BEGIN_SRC emacs-lisp
     (use-package projectile
       :config
       (projectile-global-mode)
       (setq projectile-enable-caching nil)
       (setq projectile-indexing-method 'hybrid)
       )
   #+END_SRC
** AG search
   #+BEGIN_SRC emacs-lisp
     (use-package ag
       :config
       (setq ag-highlight-search t) 
       )
   #+END_SRC
** Undo tree
   #+BEGIN_SRC emacs-lisp
     (use-package undo-tree
       :after evil
       :diminish
       :init
       (global-undo-tree-mode)
       :config
       (evil-set-undo-system 'undo-tree))
   #+END_SRC
** Clangformat
   #+BEGIN_SRC emacs-lisp
     (defun clang-format-buffer-smart ()
       "Reformat buffer if .clang-format exists in the projectile root."
       (when (f-exists? (expand-file-name ".clang-format" (projectile-project-root)))
         (clang-format-buffer)))

     (defun clang-format-buffer-smart-on-save ()
       "Add auto-save hook for clang-format-buffer-smart."
       (add-hook 'before-save-hook 'clang-format-buffer-smart nil t))

     (use-package clang-format
       :config
       (add-hook 'c-mode-hook 'clang-format-buffer-smart-on-save)
       (add-hook 'c++-mode-hook 'clang-format-buffer-smart-on-save)
       )
   #+END_SRC
** Ansicolor
   #+BEGIN_SRC emacs-lisp
     (use-package ansi-color
       :config
       (defun colorize-compilation-buffer ()
         (let ((inhibit-read-only t))
           (ansi-color-apply-on-region (point-min) (point-max))))
       (add-hook 'compilation-filter-hook 'colorize-compilation-buffer)
       )
   #+END_SRC
** Dashboard
#+BEGIN_SRC emacs-lisp
  (use-package dashboard
    :config
    (dashboard-setup-startup-hook)
    (setq dashboard-banner-logo-title "Welcome to Peixoto's Emacs!!")
    (setq dashboard-items '((recents  . 10)
                            (projects . 10)
                            (bookmarks . 5)))
    (setq dashboard-set-file-icons t)
    (setq dashboard-set-heading-icons t)
    (setq dashboard-set-footer t)
    (setq dashboard-footer-messages '("Emacs is written in Lisp, which is the only computer language that is beautiful."))
    (setq dashboard-footer-icon (all-the-icons-octicon "dashboard"
                                                       :height 1.1
                                                       :v-adjust -0.05
                                                       :face 'font-lock-keyword-face))
    )
#+END_SRC
** General
   #+BEGIN_SRC emacs-lisp
     (use-package general
       :config
       ;; Evil
       ;;; Evil leader definition
       (setq my-leader "SPC")
       (setq my-local-leader "SPC m")
       (general-create-definer my-leader-def
                               :prefix my-leader)

       (general-create-definer my-local-leader-def
                               :prefix my-local-leader)

       ;;; Evil normal state keybindings
       (general-def 'normal
         "gl" 'avy-goto-line
         "ga" 'avy-goto-subword-1
         "gc" 'evil-commentary)

       ;;; Evil normal state keybindings with LEADER
       (my-leader-def 'normal 'override
         "xcr" 'reload-config
         "xcf" 'find-config
         "q" 'delete-window
         "w" 'save-buffer)
     )
   #+END_SRC 
